{% extends "corelink/base.html" %}
{% load static %}

{% block content %}

    <!-- page header - start -->
    <div class="page-header">
        <div class="page-header-wrapper">
            <div class="page-header-inner">
                <div class="container">
                    <div class="row d-lg-flex align-items-lg-end">
                        <div class="col-lg-6">
                            <div class="page-header-content c-white">
                                <h1>Our Blog</h1>
                                <ul>
                                    <li>
                                        <a href="{% url 'index' %}" class="link-underline">
                                            <span>Home</span>
                                        </a>
                                    </li>
                                    <li>
                                        <i class="las la-angle-right"></i>
                                        <a href="{% url 'blog_list' %}" class="link-underline">
                                            <span>Blog</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="page-header-search">
                                <form method="get">
                                    <input type="text"
                                           name="q"
                                           value="{{ request.GET.q|default_if_none:'' }}"
                                           placeholder="Search">
                                    <button type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="background-pattern background-pattern-2">
                <div class="background-pattern-img background-loop"
                     style="background-image: url({% static 'corelink/assets/images/patterns/pattern.jpg' %});">
                </div>
                <div class="background-pattern-gradient"></div>
                <div class="background-pattern-bottom">
                    <div class="image"
                         style="background-image: url({% static 'corelink/assets/images/patterns/pattern-2.jpg' %});">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- page header - end -->

    <!-- blog list - start -->
    <div class="blog blog-1">
        <div class="blog-wrapper">
            <div class="container">
                <div class="row">
                    {% for post in posts %}
                        <div class="col-lg-4 col-md-6">
                            <div class="blog-single">
                                <div class="thumbnail">
                                    <a href="{% url 'blog_detail' slug=post.slug %}">
                                        {% if post.header_image %}
                                            <img src="{{ post.header_image.url }}" alt="{{ post.title }}">
                                        {% else %}
                                            <img src="{% static 'corelink/assets/images/blog/blog-1-img-1.jpg' %}" alt="{{ post.title }}">
                                        {% endif %}
                                    </a>
                                </div>
                                <div class="content c-grey">
                                    <h3 class="c-dark f-w-700">
                                        <a href="{% url 'blog_detail' slug=post.slug %}">
                                            {{ post.title }}
                                        </a>
                                    </h3>
                                    <div class="blog-single-details">
                                        <div class="date">
                                            <i class="las la-calendar"></i>
                                            {{ post.created_at|date:"M d, Y" }}
                                        </div>
                                    </div>
                                    {% if post.excerpt %}
                                        <p>{{ post.excerpt }}</p>
                                    {% else %}
                                        <p>{{ post.content|truncatewords:24 }}</p>
                                    {% endif %}
                                    <a href="{% url 'blog_detail' slug=post.slug %}"
                                       class="button button-3">
                                        Read more
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="col-12 text-center">
                            <p>No posts yet.</p>
                        </div>
                    {% endfor %}
                </div>

                {# пагинация, если включали paginate_by во вьюхе #}
                {% if is_paginated %}
                    <div class="row">
                        <div class="col-12">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link"
                                           href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                            &laquo;
                                        </a>
                                    </li>
                                {% endif %}

                                {% for num in paginator.page_range %}
                                    {% if num == page_obj.number %}
                                        <li class="page-item active">
                                            <span class="page-link">{{ num }}</span>
                                        </li>
                                    {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                                {{ num }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link"
                                           href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                            &raquo;
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- blog list - end -->

{% endblock %}
